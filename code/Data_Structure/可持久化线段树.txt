给每段前缀s[1..i]都建一棵线段树，这棵线段树存的是数字在序列中出现次数，或一段数字中每个数字在序列中出现次数之和。
这n棵线段树的结构就完全一样的，不同的只是每个节点上的数值不同而已。
发现s[1..i+1]跟s[1..i]相比只有s[i+1]这个数一直到根的logn个节点要+1，而其他部分跟s[1..i]是一样的，那么去访问的时候直接访问前一棵树的这个部分即可。于是每加一个点新增logn个节点，n棵线段树节点数只用nlogn。
查询s[x,y]的时候，只需要看s[1..x-1]和s[1..y]，每个节点的差值就是s[x,y]中nlogn个数段在序列中的出现次数。

一般情况下要离散。